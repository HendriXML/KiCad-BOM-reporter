<?xml version="1.0" encoding="utf-8" standalone="no"?>
<pkg:Library
  xsi:schemaLocation="urn:schemas-www-wisware.nl-scriptingpackages ../XmlSchemas.Common.XmlScript/XMLScripting.Packages.xsd"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="urn:schemas-www-wisware.nl-xmlscripting"
  xmlns:ado="urn:schemas-www-wisware.nl-xmlscripting-ado"
  xmlns:fil="urn:schemas-www-wisware.nl-xmlscripting-filemanagement"
  xmlns:fwl="urn:schemas-www-wisware.nl-xmlscripting-windowsfirewall"
  xmlns:inx="urn:schemas-www-wisware.nl-xmlscripting-index"
  xmlns:lil="urn:schemas-www-wisware.nl-xmlscripting-linkedlist"
  xmlns:msx="urn:schemas-www-wisware.nl-xmlscripting-xml"
  xmlns:reg="urn:schemas-www-wisware.nl-xmlscripting-registry"
  xmlns:rep="urn:schemas-www-wisware.nl-xmlscripting-report"
  xmlns:sts="urn:schemas-www-wisware.nl-xmlscripting-showstatus"
  xmlns:syu="urn:schemas-www-wisware.nl-xmlscripting-sysutils"
  xmlns:sys="urn:schemas-www-wisware.nl-xmlscripting"
  xmlns:pkg="urn:schemas-www-wisware.nl-scriptingpackages"
  >
  <Uses>
    <Use Identifier="ElectronicUtils"/>
    <Use Identifier="BomClasses"/>
    <Use Identifier="BomStrings"/>
  </Uses>
  <Type>
    <Enumeration Identifier="TResistorTechnology" Elements="Unspecified, MetalFilm, CarbonFilm, Wirewound, CarbonComposition" LowAlias="Low" HighAlias="High"/>

    <DataClass Identifier="TResistorSpec" Inherit="TComponentSpec">
      <VirtualMethod Identifier="vmHandleField" Override="true"/>
      <VirtualMethod Identifier="vmCheckComponentKind" Override="true"/>
      <VirtualMethod Identifier="vmSpecificationAsString" Override="true"/>
      <VirtualMethod Identifier="vmApplyTemplate" Override="true"/>
      <VirtualMethod Identifier="vmDoesMatchSpecification" Override="true"/>
      <VirtualMethod Identifier="vmCategoryMatchScore" Override="true"/>
      <!--<-<TComponentSpec.Fields-->
      <Field Identifier="ResistanceVT" Type="TValueType"/>
      <Field Identifier="Resistance" Type="Int64"/>
      <Field Identifier="ErrorResistance" Type="string"/>
      <Field Identifier="ResistanceMinVT" Type="TValueType"/>
      <Field Identifier="ResistanceMin" Type="Int64"/>
      <Field Identifier="ErrorResistanceMin" Type="string"/>
      <Field Identifier="ResistanceMaxVT" Type="TValueType"/>
      <Field Identifier="ResistanceMax" Type="Int64"/>
      <Field Identifier="ErrorResistanceMax" Type="string"/>
      <Field Identifier="PowerRatingVT" Type="TValueType"/>
      <Field Identifier="PowerRating" Type="Int64"/>
      <Field Identifier="ErrorPowerRating" Type="string"/>
      <Field Identifier="PowerRatingMinVT" Type="TValueType"/>
      <Field Identifier="PowerRatingMin" Type="Int64"/>
      <Field Identifier="ErrorPowerRatingMin" Type="string"/>
      <Field Identifier="PowerRatingMaxVT" Type="TValueType"/>
      <Field Identifier="PowerRatingMax" Type="Int64"/>
      <Field Identifier="ErrorPowerRatingMax" Type="string"/>
      <Field Identifier="ToleranceVT" Type="TValueType"/>
      <Field Identifier="Tolerance" Type="Int64"/>
      <Field Identifier="ErrorTolerance" Type="string"/>
      <Field Identifier="ToleranceMinVT" Type="TValueType"/>
      <Field Identifier="ToleranceMin" Type="Int64"/>
      <Field Identifier="ErrorToleranceMin" Type="string"/>
      <Field Identifier="ToleranceMaxVT" Type="TValueType"/>
      <Field Identifier="ToleranceMax" Type="Int64"/>
      <Field Identifier="ErrorToleranceMax" Type="string"/>
      <Field Identifier="TechnologyVT" Type="TValueType"/>
      <Field Identifier="Technology" Type="TResistorTechnology"/>
      <Field Identifier="ErrorTechnology" Type="string"/>
<!-->->-->
    </DataClass>

    <DataClass Identifier="TResistanceSpecificationIndex" Inherit="TSpecificationIndex" DefaultConstructor="createandsetfields">
      <VirtualMethod Identifier="vmGetKey" Override="true"/>
    </DataClass>

    <DataClass Identifier="TResistorCategory" Inherit="TComponentCategory">
      <VirtualMethod Identifier="vmCreateSpecification" Override="true"/>
      <VirtualMethod Identifier="vmIsValidSpecification" Override="true"/>
      <VirtualMethod Identifier="vmIndexSearchSpecifications" Override="true"/>
      <VirtualMethod Identifier="vmCompareSpecifications" Override="true"/>
      <VirtualMethod Identifier="vmLoadTemplatesFromIniFile" Override="true"/>
      <VirtualMethod Identifier="vmGetTemplate" Override="true"/>
      <VirtualMethod Identifier="vmCanExtractTemplateFromIniFile" Override="true"/>
      <Field Identifier="Template" Type="TResistorSpec"/>
      <Field Identifier="TemplateVariable" Type="TResistorSpec"/>
      <Field Identifier="ResistanceSpecificationIndex" Type="TResistanceSpecificationIndex"/>
    </DataClass>
  </Type>

  <Variables>
    <Variable Identifier="ResistorTechnologyIndex" Type="TMappingCaseInSensitiveUnicodeStringToInt64" Init="TMappingCaseInSensitiveUnicodeStringToInt64.Create"/>
    <Variable Identifier="ResistorResistanceConv" Type="TUnitConvertor" Init="GetUnitConvertor(TConvertorKind.MicroOhm)"/>
    <Variable Identifier="ResistorPowerRatingConv" Type="TUnitConvertor" Init="GetUnitConvertor(TConvertorKind.PicoWatt)"/>
    <Variable Identifier="ResistorToleranceConv" Type="TUnitConvertor" Init="GetUnitConvertor(TConvertorKind.MicroPerc)"/>
    <Variable Identifier="ResistorMaxVoltConv" Type="TUnitConvertor" Init="GetUnitConvertor(TConvertorKind.PicoVolt)"/>
    <Variable Identifier="ResistorMaxAmpConv" Type="TUnitConvertor" Init="GetUnitConvertor(TConvertorKind.PicoAmp)"/>
  </Variables>

  <Procedures>
    <Function Identifier="ResistorTechnologyName" Type="string">
      <Parameters>
        <Parameter Identifier="Technology" Type="TResistorTechnology"/>
      </Parameters>
      <Block>
        <Case Expression="Technology" Optimalisation="integermapping">
          <On Select="TResistorTechnology.Unspecified">
            <Execute Statement="Result:= ''"/>
          </On>
          <On Select="TResistorTechnology.MetalFilm">
            <Execute Statement="Result:= 'metal film'"/>
          </On>
          <On Select="TResistorTechnology.CarbonFilm">
            <Execute Statement="Result:= 'carbon film'"/>
          </On>
          <On Select="TResistorTechnology.Wirewound">
            <Execute Statement="Result:= 'wirewound'"/>
          </On>
          <On Select="TResistorTechnology.CarbonComposition">
            <Execute Statement="Result:= 'carbon composition'"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create('Unmapped resistor technology')"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>

    <Procedure Identifier="InitResistorTechnologyIndex">
      <Parameters>
        <Parameter Identifier="Index" Type="TAbstractBoxedValueMappingHashIndex"/>
      </Parameters>
      <Block>
        <ForLoop Indexer="I" From="TResistorTechnology.Low" To="TResistorTechnology.High">
          <inx:Index.MapValue Index="Index" Key="ResistorTechnologyName(I)" Value="I"/>
        </ForLoop>
      </Block>
    </Procedure>

    <Function Identifier="ResistorTechnologyAsString" Type="string">
      <Parameters>
        <Parameter Identifier="Technology" Type="TResistorTechnology"/>
      </Parameters>
      <Block>
        <Case Expression="Technology" Optimalisation="integermapping">
          <On Select="TResistorTechnology.Unspecified">
            <Execute Statement="Result:= ''"/>
          </On>
          <On Select="TResistorTechnology.MetalFilm">
            <Execute Statement="Result:= sResistorTechnologyMetalFilm"/>
          </On>
          <On Select="TResistorTechnology.CarbonFilm">
            <Execute Statement="Result:= sResistorTechnologyCarbonFilm"/>
          </On>
          <On Select="TResistorTechnology.Wirewound">
            <Execute Statement="Result:= sResistorTechnologyWirewound"/>
          </On>
          <On Select="TResistorTechnology.CarbonComposition">
            <Execute Statement="Result:= sResistorTechnologyCarbonComposition"/>
          </On>
          <Otherwise>
            <Execute Statement="Result:= ResistorTechnologyName(Technology)"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>


    <Function Identifier="TResistorSpec.CheckComponentKind" VirtualMethod="vmCheckComponentKind" Type="Boolean">
      <Parameters>
        <Parameter Identifier="ComponentKind" Type="TComponentKind"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= False"/>
        <Case Expression="ComponentKind" Optimalisation="integermapping">
          <On Select="TComponentKind.Resistor, TComponentKind.VariableResistor">
            <Execute Statement="Result:= True"/>
          </On>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TResistorSpec.DoesMatchSpecification" VirtualMethod="vmDoesMatchSpecification" Type="Boolean">
      <Parameters>
        <Parameter Identifier="ComponentSpec" Type="TComponentSpec"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= False"/>
        <Exit Condition="not inherited DoesMatchSpecification(ComponentSpec)"/>
        <Variable Identifier="IsRanged" Type="Boolean"/>
        <!--<-<TComponentSpec.DoesMatchSpecification-->
        <Execute Statement="IsRanged:= False"/>
        <Case Expression="ResistanceMinVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Exit Condition="not (ComponentSpec is TResistorSpec)"/>
            <Case Expression="TResistorSpec(ComponentSpec).ResistanceVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="ResistanceMin &gt; TResistorSpec(ComponentSpec).Resistance"/>
                <Execute Statement="IsRanged:= True"/>
              </On>
               <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                 <Exit/>
               </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit/>
          </On>
        </Case>
        <Case Expression="ResistanceMaxVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Exit Condition="not (ComponentSpec is TResistorSpec)"/>
            <Case Expression="TResistorSpec(ComponentSpec).ResistanceVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="ResistanceMax &lt; TResistorSpec(ComponentSpec).Resistance"/>
                <Execute Statement="IsRanged:= True"/>
              </On>
               <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                 <Exit/>
               </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit/>
          </On>
        </Case>
        <Block Condition="not IsRanged">
          <Case Expression="ResistanceVT">
            <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
              <Exit Condition="not (ComponentSpec is TResistorSpec)"/>
              <Case Expression="TResistorSpec(ComponentSpec).ResistanceVT">
                <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                  <Exit Condition="Resistance &lt;&gt; TResistorSpec(ComponentSpec).Resistance"/>
                </On>
                 <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                   <Exit/>
                 </On>
              </Case>
            </On>
            <On Select="TValueType.Error, TValueType.ErrorByTemplate">
              <Exit/>
            </On>
          </Case>
        </Block>
        <Execute Statement="IsRanged:= False"/>
        <Case Expression="PowerRatingMinVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Exit Condition="not (ComponentSpec is TResistorSpec)"/>
            <Case Expression="TResistorSpec(ComponentSpec).PowerRatingVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="PowerRatingMin &gt; TResistorSpec(ComponentSpec).PowerRating"/>
                <Execute Statement="IsRanged:= True"/>
              </On>
               <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                 <Exit/>
               </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit/>
          </On>
        </Case>
        <Case Expression="PowerRatingMaxVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Exit Condition="not (ComponentSpec is TResistorSpec)"/>
            <Case Expression="TResistorSpec(ComponentSpec).PowerRatingVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="PowerRatingMax &lt; TResistorSpec(ComponentSpec).PowerRating"/>
                <Execute Statement="IsRanged:= True"/>
              </On>
               <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                 <Exit/>
               </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit/>
          </On>
        </Case>
        <Block Condition="not IsRanged">
          <Case Expression="PowerRatingVT">
            <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
              <Exit Condition="not (ComponentSpec is TResistorSpec)"/>
              <Case Expression="TResistorSpec(ComponentSpec).PowerRatingVT">
                <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                  <Exit Condition="PowerRating &lt;&gt; TResistorSpec(ComponentSpec).PowerRating"/>
                </On>
                 <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                   <Exit/>
                 </On>
              </Case>
            </On>
            <On Select="TValueType.Error, TValueType.ErrorByTemplate">
              <Exit/>
            </On>
          </Case>
        </Block>
        <Execute Statement="IsRanged:= False"/>
        <Case Expression="ToleranceMinVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Exit Condition="not (ComponentSpec is TResistorSpec)"/>
            <Case Expression="TResistorSpec(ComponentSpec).ToleranceVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="ToleranceMin &gt; TResistorSpec(ComponentSpec).Tolerance"/>
                <Execute Statement="IsRanged:= True"/>
              </On>
               <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                 <Exit/>
               </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit/>
          </On>
        </Case>
        <Case Expression="ToleranceMaxVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Exit Condition="not (ComponentSpec is TResistorSpec)"/>
            <Case Expression="TResistorSpec(ComponentSpec).ToleranceVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="ToleranceMax &lt; TResistorSpec(ComponentSpec).Tolerance"/>
                <Execute Statement="IsRanged:= True"/>
              </On>
               <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                 <Exit/>
               </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit/>
          </On>
        </Case>
        <Block Condition="not IsRanged">
          <Case Expression="ToleranceVT">
            <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
              <Exit Condition="not (ComponentSpec is TResistorSpec)"/>
              <Case Expression="TResistorSpec(ComponentSpec).ToleranceVT">
                <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                  <Exit Condition="Tolerance &lt;&gt; TResistorSpec(ComponentSpec).Tolerance"/>
                </On>
                 <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                   <Exit/>
                 </On>
              </Case>
            </On>
            <On Select="TValueType.Error, TValueType.ErrorByTemplate">
              <Exit/>
            </On>
          </Case>
        </Block>
        <Case Expression="TechnologyVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Exit Condition="not (ComponentSpec is TResistorSpec)"/>
            <Case Expression="TResistorSpec(ComponentSpec).TechnologyVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="Technology &lt;&gt; TResistorSpec(ComponentSpec).Technology"/>
              </On>
               <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                 <Exit/>
               </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit/>
          </On>
        </Case>
<!-->->-->
        <Execute Statement="Result:= True"/>
      </Block>
    </Function>

    <Function Identifier="TResistorSpec.CategoryMatchScore" VirtualMethod="vmCategoryMatchScore" Type="Int64">
      <Parameters>
        <Parameter Identifier="ComponentSpec" Type="TComponentSpec"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= 0"/>

        <Exit Condition="not (ComponentSpec is TResistorSpec)"/>

        <Case Expression="ComponentKindVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Case Expression="ComponentSpec.ComponentKindVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="ComponentKind &lt;&gt; ComponentSpec.ComponentKind" Result="0"/>
                <Execute Statement="Result:= Result + 1"/>
              </On>
              <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                <Exit Result="0"/>
              </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit Result="0"/>
          </On>
        </Case>

        <Execute Statement="Result:= Result shl 1"/>
        <Case Expression="ResistanceVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Case Expression="TResistorSpec(ComponentSpec).ResistanceVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="Resistance &lt;&gt; TResistorSpec(ComponentSpec).Resistance" Result="0"/>
                <Execute Statement="Result:= Result + 1"/>
              </On>
              <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                <Exit Result="0"/>
              </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit Result="0"/>
          </On>
        </Case>

        <Execute Statement="Result:= Result shl 1"/>
        <Case Expression="PowerRatingVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Case Expression="TResistorSpec(ComponentSpec).PowerRatingVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="PowerRating &lt;&gt; TResistorSpec(ComponentSpec).PowerRating" Result="0"/>
                <Execute Statement="Result:= Result + 1"/>
              </On>
              <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                <Exit Result="0"/>
              </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit Result="0"/>
          </On>
        </Case>

        <Execute Statement="Result:= Result shl 1"/>
        <Case Expression="FootprintVT">
          <On Select="TFootPrintValueType.SpecifiedByTemplate, TFootPrintValueType.Specified">
            <Case Expression="ComponentSpec.FootprintVT">
              <On Select="TFootPrintValueType.SpecifiedByTemplate, TFootPrintValueType.Specified">
                <Execute Statement="Result:= Result + 1" Condition="Footprint = ComponentSpec.Footprint"/>
              </On>
              <On Select="TFootPrintValueType.MaskSpecifiedByTemplate, TFootPrintValueType.MaskSpecified">
                <Execute Statement="Result:= Result + 1" Condition="ComponentSpec.FootprintMask.Matches(Footprint)"/>
              </On>
              <On Select="TFootPrintValueType.Unspecified, TFootPrintValueType.Cleared, TFootPrintValueType.ClearedByTemplate">
              </On>
              <Otherwise>
                <Exit/>
              </Otherwise>
            </Case>
          </On>
          <On Select="TFootPrintValueType.Error, TFootPrintValueType.ErrorByTemplate">
            <Exit/>
          </On>
        </Case>

        <Execute Statement="Result:= Result shl 1"/>
        <Case Expression="TechnologyVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Case Expression="TResistorSpec(ComponentSpec).TechnologyVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="Technology &lt;&gt; TResistorSpec(ComponentSpec).Technology" Result="0"/>
                <Execute Statement="Result:= Result + 1"/>
              </On>
              <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                <Exit Result="0"/>
              </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit Result="0"/>
          </On>
        </Case>

        <Execute Statement="Result:= Result shl 1"/>
        <Case Expression="ToleranceVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Case Expression="TResistorSpec(ComponentSpec).ToleranceVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="Tolerance &lt;&gt; TResistorSpec(ComponentSpec).Tolerance" Result="0"/>
                <Execute Statement="Result:= Result + 1"/>
              </On>
              <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                <Exit Result="0"/>
              </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit Result="0"/>
          </On>
        </Case>

        <Execute Statement="Result:= Result shl 1"/>
        <Case Expression="PartNumberVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Case Expression="ComponentSpec.PartNumberVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="not SameText(PartNumber, ComponentSpec.PartNumber)" Result="0"/>
                <Execute Statement="Result:= Result + 1"/>
              </On>
              <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                <Exit Result="0"/>
              </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit Result="0"/>
          </On>
        </Case>

        <Execute Statement="Result:= Result shl 1"/>
        <Case Expression="ManufacturerVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Case Expression="ComponentSpec.ManufacturerVT">
              <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                <Exit Condition="not SameText(Manufacturer, ComponentSpec.Manufacturer)" Result="0"/>
                <Execute Statement="Result:= Result + 1"/>
              </On>
              <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                <Exit Result="0"/>
              </On>
            </Case>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Exit Result="0"/>
          </On>
        </Case>
      </Block>
    </Function>

    <Procedure Identifier="TResistorSpec.HandleField" VirtualMethod="vmHandleField">
      <Parameters>
        <Parameter Identifier="CustomField" Type="TCustomField"/>
        <Parameter Identifier="Name" Type="string"/>
        <Parameter Identifier="Value" Type="string"/>
        <Parameter Identifier="Clear" Type="Boolean"/>
      </Parameters>
      <Variables>
        <Variable Identifier="LocValue" Type="Int64"/>
        <Variable Identifier="LocResistorTechnology" Type="TResistorTechnology"/>
        <Variable Identifier="Found" Type="Boolean"/>
      </Variables>
      <Block>
        <Case Expression="CustomField" Optimalisation="integermapping">
          <!--<-<TComponentSpec.HandleField-->
          <On Select="TCustomField.Value">
            <Choose>
              <When Expression="Clear">
                <Execute Statement="ResistanceVT:= TValueType.Cleared"/>
                <Execute Statement="Resistance:= -1"/>
              </When>
              <When Expression="ResistorResistanceConv.StrToIntValue(Value, LocValue)">
                <Execute Statement="ResistanceVT:= TValueType.Specified"/>
                <Execute Statement="Resistance:= LocValue"/>
              </When>
              <Otherwise>
                <Execute Statement="ResistanceVT:= TValueType.Error"/>
                <Execute Statement="ErrorResistance:= Value"/>
              </Otherwise>
            </Choose>
          </On>
          <On Select="TCustomField.ValueMin">
            <Choose>
              <When Expression="Clear">
                <Execute Statement="ResistanceMinVT:= TValueType.Cleared"/>
                <Execute Statement="ResistanceMin:= -1"/>
              </When>
              <When Expression="ResistorResistanceConv.StrToIntValue(Value, LocValue)">
                <Execute Statement="ResistanceMinVT:= TValueType.Specified"/>
                <Execute Statement="ResistanceMin:= LocValue"/>
              </When>
              <Otherwise>
                <Execute Statement="ResistanceMinVT:= TValueType.Error"/>
                <Execute Statement="ErrorResistanceMin:= Value"/>
              </Otherwise>
            </Choose>
          </On>
          <On Select="TCustomField.ValueMax">
            <Choose>
              <When Expression="Clear">
                <Execute Statement="ResistanceMaxVT:= TValueType.Cleared"/>
                <Execute Statement="ResistanceMax:= -1"/>
              </When>
              <When Expression="ResistorResistanceConv.StrToIntValue(Value, LocValue)">
                <Execute Statement="ResistanceMaxVT:= TValueType.Specified"/>
                <Execute Statement="ResistanceMax:= LocValue"/>
              </When>
              <Otherwise>
                <Execute Statement="ResistanceMaxVT:= TValueType.Error"/>
                <Execute Statement="ErrorResistanceMax:= Value"/>
              </Otherwise>
            </Choose>
          </On>
          <On Select="TCustomField.PowerRating">
            <Choose>
              <When Expression="Clear">
                <Execute Statement="PowerRatingVT:= TValueType.Cleared"/>
                <Execute Statement="PowerRating:= -1"/>
              </When>
              <When Expression="ResistorPowerRatingConv.StrToIntValue(Value, LocValue)">
                <Execute Statement="PowerRatingVT:= TValueType.Specified"/>
                <Execute Statement="PowerRating:= LocValue"/>
              </When>
              <Otherwise>
                <Execute Statement="PowerRatingVT:= TValueType.Error"/>
                <Execute Statement="ErrorPowerRating:= Value"/>
              </Otherwise>
            </Choose>
          </On>
          <On Select="TCustomField.PowerRatingMin">
            <Choose>
              <When Expression="Clear">
                <Execute Statement="PowerRatingMinVT:= TValueType.Cleared"/>
                <Execute Statement="PowerRatingMin:= -1"/>
              </When>
              <When Expression="ResistorPowerRatingConv.StrToIntValue(Value, LocValue)">
                <Execute Statement="PowerRatingMinVT:= TValueType.Specified"/>
                <Execute Statement="PowerRatingMin:= LocValue"/>
              </When>
              <Otherwise>
                <Execute Statement="PowerRatingMinVT:= TValueType.Error"/>
                <Execute Statement="ErrorPowerRatingMin:= Value"/>
              </Otherwise>
            </Choose>
          </On>
          <On Select="TCustomField.PowerRatingMax">
            <Choose>
              <When Expression="Clear">
                <Execute Statement="PowerRatingMaxVT:= TValueType.Cleared"/>
                <Execute Statement="PowerRatingMax:= -1"/>
              </When>
              <When Expression="ResistorPowerRatingConv.StrToIntValue(Value, LocValue)">
                <Execute Statement="PowerRatingMaxVT:= TValueType.Specified"/>
                <Execute Statement="PowerRatingMax:= LocValue"/>
              </When>
              <Otherwise>
                <Execute Statement="PowerRatingMaxVT:= TValueType.Error"/>
                <Execute Statement="ErrorPowerRatingMax:= Value"/>
              </Otherwise>
            </Choose>
          </On>
          <On Select="TCustomField.Tolerance">
            <Choose>
              <When Expression="Clear">
                <Execute Statement="ToleranceVT:= TValueType.Cleared"/>
                <Execute Statement="Tolerance:= -1"/>
              </When>
              <When Expression="ResistorToleranceConv.StrToIntValue(Value, LocValue)">
                <Execute Statement="ToleranceVT:= TValueType.Specified"/>
                <Execute Statement="Tolerance:= LocValue"/>
              </When>
              <Otherwise>
                <Execute Statement="ToleranceVT:= TValueType.Error"/>
                <Execute Statement="ErrorTolerance:= Value"/>
              </Otherwise>
            </Choose>
          </On>
          <On Select="TCustomField.ToleranceMin">
            <Choose>
              <When Expression="Clear">
                <Execute Statement="ToleranceMinVT:= TValueType.Cleared"/>
                <Execute Statement="ToleranceMin:= -1"/>
              </When>
              <When Expression="ResistorToleranceConv.StrToIntValue(Value, LocValue)">
                <Execute Statement="ToleranceMinVT:= TValueType.Specified"/>
                <Execute Statement="ToleranceMin:= LocValue"/>
              </When>
              <Otherwise>
                <Execute Statement="ToleranceMinVT:= TValueType.Error"/>
                <Execute Statement="ErrorToleranceMin:= Value"/>
              </Otherwise>
            </Choose>
          </On>
          <On Select="TCustomField.ToleranceMax">
            <Choose>
              <When Expression="Clear">
                <Execute Statement="ToleranceMaxVT:= TValueType.Cleared"/>
                <Execute Statement="ToleranceMax:= -1"/>
              </When>
              <When Expression="ResistorToleranceConv.StrToIntValue(Value, LocValue)">
                <Execute Statement="ToleranceMaxVT:= TValueType.Specified"/>
                <Execute Statement="ToleranceMax:= LocValue"/>
              </When>
              <Otherwise>
                <Execute Statement="ToleranceMaxVT:= TValueType.Error"/>
                <Execute Statement="ErrorToleranceMax:= Value"/>
              </Otherwise>
            </Choose>
          </On>
          <On Select="TCustomField.Technology">
            <Choose>
              <When Expression="Clear">
                <Execute Statement="TechnologyVT:= TValueType.Cleared"/>
              </When>
              <Otherwise>
                <inx:Index.FindValue Index="ResistorTechnologyIndex" Key="Value" Value="LocResistorTechnology" Found="Found" Flags="NoErrorOnNotFound"/>
                  <Choose>
                    <When Expression="Found">
                      <Execute Statement="Technology:= LocResistorTechnology"/>
                      <Execute Statement="TechnologyVT:= TValueType.Specified"/>
                    </When>
                    <Otherwise>
                      <Execute Statement="ErrorTechnology:= Value"/>
                      <Execute Statement="TechnologyVT:= TValueType.Error"/>
                    </Otherwise>
                 </Choose>
              </Otherwise>
            </Choose>
          </On>
<!-->->-->
          <Otherwise>
            <Execute Statement="inherited HandleField(CustomField, Name, Value, Clear)"/>
          </Otherwise>
        </Case>
      </Block>
    </Procedure>

    <Procedure Identifier="TResistorSpec.GetSpecificationValues">
      <Parameters>
        <Parameter Identifier="FormatType" Type="TSpecFormatType"/>
        <Parameter Identifier="Resistance" Type="string" Direction="Output"/>
        <Parameter Identifier="ESerie" Type="string" Direction="Output"/>
        <Parameter Identifier="PowerRating" Type="string" Direction="Output"/>
        <Parameter Identifier="MaxAmpVolt" Type="string" Direction="Output"/>
        <Parameter Identifier="Tolerance" Type="string" Direction="Output"/>
        <Parameter Identifier="Technology" Type="string" Direction="Output"/>
        <Parameter Identifier="Footprint" Type="string" Direction="Output"/>
        <Parameter Identifier="PartNumberModel" Type="string" Direction="Output"/>
        <Parameter Identifier="InternalPartNumber" Type="string" Direction="Output"/>
        <Parameter Identifier="ComponentKind" Type="string" Direction="Output"/>
      </Parameters>
      <Block>
        <Variable Identifier="Compact" Type="Boolean" Init="FormatType &lt;&gt; TSpecFormatType.Name"/>
        <Variable Identifier="Range" Type="string"/>
        <!--<-<TComponentSpec.GetSpecificationValues-->
        <Case Expression="ResistanceMinVT">
          <On Select="TValueType.Unspecified, TValueType.Cleared, TValueType.ClearedByTemplate">
            <Execute Statement="Range:= ''"/>
          </On>
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="Range:= ResistorResistanceConv.IntValueToStr(Self.ResistanceMin, Compact) + '..'"/>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="Range:= '!' + ErrorResistanceMin + '!' + '..'"/>
          </On>
        </Case>
        <Case Expression="ResistanceMaxVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="Range:= '..'" Condition="IsEmptyString(Range)"/>
            <Execute Statement="Range:= Range + ResistorResistanceConv.IntValueToStr(Self.ResistanceMax, Compact)"/>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="Range:= '..'" Condition="IsEmptyString(Range)"/>
            <Execute Statement="Range:= Range + '!' + ErrorResistanceMax + '!' "/>
          </On>
        </Case>
        <Execute Statement="Range:= '{' + Range + '}'" Condition="IsNonEmptyString(Range)"/>
        <Case Expression="ResistanceVT">
          <On Select="TValueType.Unspecified, TValueType.Cleared, TValueType.ClearedByTemplate">
            <Execute Statement="Resistance:= Range"/>
          </On>
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="Resistance:= ResistorResistanceConv.IntValueToStr(Self.Resistance, Compact) + Range"/>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="Resistance:= '!' + ErrorResistance + '!' + Range"/>
          </On>
        </Case>
        <Case Expression="PowerRatingMinVT">
          <On Select="TValueType.Unspecified, TValueType.Cleared, TValueType.ClearedByTemplate">
            <Execute Statement="Range:= ''"/>
          </On>
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="Range:= ResistorPowerRatingConv.IntValueToStr(Self.PowerRatingMin, Compact) + '..'"/>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="Range:= '!' + ErrorPowerRatingMin + '!' + '..'"/>
          </On>
        </Case>
        <Case Expression="PowerRatingMaxVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="Range:= '..'" Condition="IsEmptyString(Range)"/>
            <Execute Statement="Range:= Range + ResistorPowerRatingConv.IntValueToStr(Self.PowerRatingMax, Compact)"/>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="Range:= '..'" Condition="IsEmptyString(Range)"/>
            <Execute Statement="Range:= Range + '!' + ErrorPowerRatingMax + '!' "/>
          </On>
        </Case>
        <Execute Statement="Range:= '{' + Range + '}'" Condition="IsNonEmptyString(Range)"/>
        <Case Expression="PowerRatingVT">
          <On Select="TValueType.Unspecified, TValueType.Cleared, TValueType.ClearedByTemplate">
            <Execute Statement="PowerRating:= Range"/>
          </On>
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="PowerRating:= ResistorPowerRatingConv.IntValueToStr(Self.PowerRating, Compact) + Range"/>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="PowerRating:= '!' + ErrorPowerRating + '!' + Range"/>
          </On>
        </Case>
        <Case Expression="ToleranceMinVT">
          <On Select="TValueType.Unspecified, TValueType.Cleared, TValueType.ClearedByTemplate">
            <Execute Statement="Range:= ''"/>
          </On>
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="Range:= ResistorToleranceConv.IntValueToStr(Self.ToleranceMin, Compact) + '..'"/>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="Range:= '!' + ErrorToleranceMin + '!' + '..'"/>
          </On>
        </Case>
        <Case Expression="ToleranceMaxVT">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="Range:= '..'" Condition="IsEmptyString(Range)"/>
            <Execute Statement="Range:= Range + ResistorToleranceConv.IntValueToStr(Self.ToleranceMax, Compact)"/>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="Range:= '..'" Condition="IsEmptyString(Range)"/>
            <Execute Statement="Range:= Range + '!' + ErrorToleranceMax + '!' "/>
          </On>
        </Case>
        <Execute Statement="Range:= '{' + Range + '}'" Condition="IsNonEmptyString(Range)"/>
        <Case Expression="ToleranceVT">
          <On Select="TValueType.Unspecified, TValueType.Cleared, TValueType.ClearedByTemplate">
            <Execute Statement="Tolerance:= Range"/>
          </On>
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="Tolerance:= ResistorToleranceConv.IntValueToStr(Self.Tolerance, Compact) + Range"/>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="Tolerance:= '!' + ErrorTolerance + '!' + Range"/>
          </On>
        </Case>
        <Case Expression="TechnologyVT">
          <On Select="TValueType.Unspecified, TValueType.Cleared, TValueType.ClearedByTemplate">
            <Execute Statement="Technology:= ''"/>
          </On>
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="Technology:= ResistorTechnologyAsString(Self.Technology)"/>
          </On>
          <On Select="TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="Technology:= '!' + ErrorTechnology + '!'"/>
          </On>
        </Case>
<!-->->-->

        <Execute Statement="MaxAmpVolt:= ''"/>
        <Case Expression="ResistanceVT">
          <On Select="TValueType.Unspecified, TValueType.Cleared, TValueType.ClearedByTemplate, TValueType.Error, TValueType.ErrorByTemplate">
            <Execute Statement="ESerie:= ''"/>
          </On>
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="ESerie:= ESerieOfValue(Self.Resistance)"/>
            <Block Condition="not HideResistorMaxAmpVolt">
              <Case Expression="PowerRatingVT">
                <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                  <Variable Identifier="MaxPicoVoltage" Type="Int64" Init="Trunc(CatchFloatE(Sqrt(Self.PowerRating / cFactorToPico * Self.Resistance / cFactorToMicro)) * cFactorToPico) " DisabledChecks="error"/>
                  <Choose>
                    <When Expression="IsError(MaxPicoVoltage)">
                      <Execute Statement="MaxAmpVolt:= '?'"/>
                    </When>
                    <When Expression="MaxPicoVoltage &gt; MaxShowResistorVoltage"/>
                    <When Expression="MaxPicoVoltage = 0">
                      <Execute Statement="MaxAmpVolt:= '0V'"/>
                    </When>
                    <Otherwise>
                      <Variable Identifier="MaxPicoAmp" Init="Trunc(Self.PowerRating / MaxPicoVoltage * cFactorToPico)" DisabledChecks="error"/>
                      <Choose>
                        <When Expression="IsError(MaxPicoAmp)">
                          <Execute Statement="MaxAmpVolt:= '?'"/>
                        </When>
                        <Otherwise>
                          <Execute Statement="MaxAmpVolt:= ResistorMaxVoltConv.IntValueToStr(SignificantTrunc(MaxPicoVoltage, 1000), Compact) + '|' + ResistorMaxAmpConv.IntValueToStr(SignificantTrunc(MaxPicoAmp, 1000), Compact)"/>
                        </Otherwise>
                      </Choose>
                    </Otherwise>
                  </Choose>
                </On>
              </Case>
            </Block>
          </On>
        </Case>
        <Execute Statement="inherited GetSpecificationValues(FormatType, Footprint, PartNumberModel, InternalPartNumber, ComponentKind)"/>
      </Block>
    </Procedure>

    <Function Identifier="TResistorSpec.SpecificationAsString" VirtualMethod="vmSpecificationAsString" Type="string">
      <Parameters>
        <Parameter Identifier="FormatType" Type="TSpecFormatType"/>
        <Parameter Identifier="ReportContext" Type="TSpecReportContext"/>
      </Parameters>
      <Variables>
        <Variable Identifier="Value" Type="string" Init="''"/>
        <Variable Identifier="ESerie" Type="string" Init="''"/>
        <Variable Identifier="PowerRating" Type="string" Init="''"/>
        <Variable Identifier="MaxAmpVolt" Type="string" Init="''"/>
        <Variable Identifier="Tolerance" Type="string" Init="''"/>
        <Variable Identifier="Technology" Type="string" Init="''"/>
        <Variable Identifier="Footprint" Type="string" Init="''"/>
        <Variable Identifier="PartNumberModel" Type="string" Init="''"/>
        <Variable Identifier="InternalPartNumber" Type="string"/>
        <Variable Identifier="ComponentKind" Type="string" Init="''"/>
      </Variables>
      <Block>
        <Execute Statement="GetSpecificationValues(FormatType, Value, ESerie, PowerRating, MaxAmpVolt, Tolerance, Technology, Footprint, PartNumberModel, InternalPartNumber, ComponentKind)"/>
        <Case Expression="FormatType" Optimalisation="integermapping">
          <On Select="TSpecFormatType.Fixed">
            <Variable Identifier="ColumnManager" Type="TTextColumnManager" Init="ReportContext.ColumnManager"/>
            <Variable Identifier="ColumnOffset" Type="Integer" Init="ReportContext.ColumnOffset"/>
            <Execute Statement="Value:= Value + ' '" Condition="IsNonEmptyString(Value)"/>
            <Execute Statement="ESerie:= ESerie + ' '" Condition="IsNonEmptyString(ESerie)"/>
            <Execute Statement="PowerRating:= PowerRating + ' '" Condition="IsNonEmptyString(PowerRating)"/>
            <Execute Statement="MaxAmpVolt:= MaxAmpVolt + ' '" Condition="IsNonEmptyString(MaxAmpVolt)"/>
            <Execute Statement="Tolerance:= Tolerance + ' '" Condition="IsNonEmptyString(Tolerance)"/>
            <Execute Statement="Technology:= Technology + ' '" Condition="IsNonEmptyString(Technology)"/>
            <Execute Statement="Footprint:= Footprint + ' '" Condition="IsNonEmptyString(Footprint)"/>
            <Execute Statement="PartNumberModel:= PartNumberModel + ' '" Condition="IsNonEmptyString(PartNumberModel)"/>
            <Execute Statement="InternalPartNumber:= InternalPartNumber + ' '" Condition="IsNonEmptyString(InternalPartNumber)"/>
            <Choose>
              <When Expression="ReportContext.Measure">
                <Execute Statement="ColumnManager.RequestColumnWidth(ColumnOffset + TResistorSpecColumns.Value, 1, Length(Value))"/>
                <Execute Statement="ColumnManager.RequestColumnWidth(ColumnOffset + TResistorSpecColumns.ESerie, 1, Length(ESerie))"/>
                <Execute Statement="ColumnManager.RequestColumnWidth(ColumnOffset + TResistorSpecColumns.PowerRating, 1, Length(PowerRating))"/>
                <Execute Statement="ColumnManager.RequestColumnWidth(ColumnOffset + TResistorSpecColumns.MaxAmpVolt, 1, Length(MaxAmpVolt))"/>
                <Execute Statement="ColumnManager.RequestColumnWidth(ColumnOffset + TResistorSpecColumns.Tolerance, 1, Length(Tolerance))"/>
                <Execute Statement="ColumnManager.RequestColumnWidth(ColumnOffset + TResistorSpecColumns.Technology, 1, Length(Technology))"/>
                <Execute Statement="ColumnManager.RequestColumnWidth(ColumnOffset + TResistorSpecColumns.FootPrint, 1, Length(Footprint))"/>
                <Execute Statement="ColumnManager.RequestColumnWidth(ColumnOffset + TResistorSpecColumns.PartNumberModel, 1, Length(PartNumberModel))"/>
                <Execute Statement="ColumnManager.RequestColumnWidth(ColumnOffset + TResistorSpecColumns.InternalPartNumber, 1, Length(InternalPartNumber))"/>
                <Execute Statement="Result:= ''"/>
              </When>
              <Otherwise>
                <Execute Statement="Result:= Format('%*s%*s%*s%-*s%*s%-*s%-*s%-*s%-*s',
                         ColumnManager.GetColumnWidth(ColumnOffset + TResistorSpecColumns.Value, 1), Value,
                         ColumnManager.GetColumnWidth(ColumnOffset + TResistorSpecColumns.ESerie, 1), ESerie,
                         ColumnManager.GetColumnWidth(ColumnOffset + TResistorSpecColumns.PowerRating, 1), PowerRating,
                         ColumnManager.GetColumnWidth(ColumnOffset + TResistorSpecColumns.MaxAmpVolt, 1), MaxAmpVolt,
                         ColumnManager.GetColumnWidth(ColumnOffset + TResistorSpecColumns.Tolerance, 1), Tolerance,
                         ColumnManager.GetColumnWidth(ColumnOffset + TResistorSpecColumns.Technology, 1), Technology,
                         ColumnManager.GetColumnWidth(ColumnOffset + TResistorSpecColumns.FootPrint, 1), Footprint,
                         ColumnManager.GetColumnWidth(ColumnOffset + TResistorSpecColumns.PartNumberModel, 1), PartNumberModel,
                         ColumnManager.GetColumnWidth(ColumnOffset + TResistorSpecColumns.InternalPartNumber, 1), InternalPartNumber)"/>
              </Otherwise>
            </Choose>
          </On>
          <On Select="TSpecFormatType.Description">
            <Execute Statement="Result:= ConcatExt(' ', True, Value, Tolerance, PowerRating, Footprint, PartNumberModel, InternalPartNumber, Technology, ComponentKind)"/>
          </On>
          <On Select="TSpecFormatType.Name">
            <Execute Statement="Result:= Value"/>
          </On>
        </Case>
      </Block>
    </Function>

    <Procedure Identifier="TResistorSpec.ApplyTemplate" VirtualMethod="vmApplyTemplate">
      <Variables>
        <Variable Identifier="locTemplate" Type="TResistorSpec"/>
      </Variables>
      <Block>
        <Exit Condition="not Assigned(Template)"/>
        <ConditionalBlock Expression="Template is TResistorSpec">
          <Execute Statement="locTemplate:= TResistorSpec(Template)"/>
          <!--<-<TComponentSpec.ApplyTemplate-->
          <Case Expression="ResistanceVT">
            <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate, TValueType.SpecifiedByTemplate, TValueType.ErrorByTemplate">
              <Case Expression="ResistanceMinVT">
                <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate, TValueType.SpecifiedByTemplate, TValueType.ErrorByTemplate">
                  <Case Expression="ResistanceMaxVT">
                    <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate, TValueType.SpecifiedByTemplate, TValueType.ErrorByTemplate">
                      <Case Expression="locTemplate.ResistanceVT">
                        <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                          <Execute Statement="Resistance:= locTemplate.Resistance"/>
                          <Execute Statement="ResistanceVT:= TValueType.SpecifiedByTemplate"/>
                        </On>
                        <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                          <Execute Statement="Resistance:= locTemplate.ErrorResistance"/>
                          <Execute Statement="ResistanceVT:= TValueType.ErrorByTemplate"/>
                        </On>
                      </Case>
                      <Case Expression="locTemplate.ResistanceMinVT">
                        <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                          <Execute Statement="ResistanceMin:= locTemplate.ResistanceMin"/>
                          <Execute Statement="ResistanceMinVT:= TValueType.SpecifiedByTemplate"/>
                        </On>
                        <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                          <Execute Statement="ResistanceMin:= locTemplate.ErrorResistanceMin"/>
                          <Execute Statement="ResistanceMinVT:= TValueType.ErrorByTemplate"/>
                        </On>
                      </Case>
                      <Case Expression="locTemplate.ResistanceMaxVT">
                        <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                          <Execute Statement="ResistanceMax:= locTemplate.ResistanceMax"/>
                          <Execute Statement="ResistanceMaxVT:= TValueType.SpecifiedByTemplate"/>
                        </On>
                        <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                          <Execute Statement="ResistanceMax:= locTemplate.ErrorResistanceMax"/>
                          <Execute Statement="ResistanceMaxVT:= TValueType.ErrorByTemplate"/>
                        </On>
                      </Case>
                    </On>
                  </Case>
                </On>
              </Case>
            </On>
          </Case>
          <Case Expression="PowerRatingVT">
            <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate, TValueType.SpecifiedByTemplate, TValueType.ErrorByTemplate">
              <Case Expression="PowerRatingMinVT">
                <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate, TValueType.SpecifiedByTemplate, TValueType.ErrorByTemplate">
                  <Case Expression="PowerRatingMaxVT">
                    <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate, TValueType.SpecifiedByTemplate, TValueType.ErrorByTemplate">
                      <Case Expression="locTemplate.PowerRatingVT">
                        <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                          <Execute Statement="PowerRating:= locTemplate.PowerRating"/>
                          <Execute Statement="PowerRatingVT:= TValueType.SpecifiedByTemplate"/>
                        </On>
                        <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                          <Execute Statement="PowerRating:= locTemplate.ErrorPowerRating"/>
                          <Execute Statement="PowerRatingVT:= TValueType.ErrorByTemplate"/>
                        </On>
                      </Case>
                      <Case Expression="locTemplate.PowerRatingMinVT">
                        <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                          <Execute Statement="PowerRatingMin:= locTemplate.PowerRatingMin"/>
                          <Execute Statement="PowerRatingMinVT:= TValueType.SpecifiedByTemplate"/>
                        </On>
                        <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                          <Execute Statement="PowerRatingMin:= locTemplate.ErrorPowerRatingMin"/>
                          <Execute Statement="PowerRatingMinVT:= TValueType.ErrorByTemplate"/>
                        </On>
                      </Case>
                      <Case Expression="locTemplate.PowerRatingMaxVT">
                        <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                          <Execute Statement="PowerRatingMax:= locTemplate.PowerRatingMax"/>
                          <Execute Statement="PowerRatingMaxVT:= TValueType.SpecifiedByTemplate"/>
                        </On>
                        <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                          <Execute Statement="PowerRatingMax:= locTemplate.ErrorPowerRatingMax"/>
                          <Execute Statement="PowerRatingMaxVT:= TValueType.ErrorByTemplate"/>
                        </On>
                      </Case>
                    </On>
                  </Case>
                </On>
              </Case>
            </On>
          </Case>
          <Case Expression="ToleranceVT">
            <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate, TValueType.SpecifiedByTemplate, TValueType.ErrorByTemplate">
              <Case Expression="ToleranceMinVT">
                <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate, TValueType.SpecifiedByTemplate, TValueType.ErrorByTemplate">
                  <Case Expression="ToleranceMaxVT">
                    <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate, TValueType.SpecifiedByTemplate, TValueType.ErrorByTemplate">
                      <Case Expression="locTemplate.ToleranceVT">
                        <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                          <Execute Statement="Tolerance:= locTemplate.Tolerance"/>
                          <Execute Statement="ToleranceVT:= TValueType.SpecifiedByTemplate"/>
                        </On>
                        <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                          <Execute Statement="Tolerance:= locTemplate.ErrorTolerance"/>
                          <Execute Statement="ToleranceVT:= TValueType.ErrorByTemplate"/>
                        </On>
                      </Case>
                      <Case Expression="locTemplate.ToleranceMinVT">
                        <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                          <Execute Statement="ToleranceMin:= locTemplate.ToleranceMin"/>
                          <Execute Statement="ToleranceMinVT:= TValueType.SpecifiedByTemplate"/>
                        </On>
                        <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                          <Execute Statement="ToleranceMin:= locTemplate.ErrorToleranceMin"/>
                          <Execute Statement="ToleranceMinVT:= TValueType.ErrorByTemplate"/>
                        </On>
                      </Case>
                      <Case Expression="locTemplate.ToleranceMaxVT">
                        <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                          <Execute Statement="ToleranceMax:= locTemplate.ToleranceMax"/>
                          <Execute Statement="ToleranceMaxVT:= TValueType.SpecifiedByTemplate"/>
                        </On>
                        <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                          <Execute Statement="ToleranceMax:= locTemplate.ErrorToleranceMax"/>
                          <Execute Statement="ToleranceMaxVT:= TValueType.ErrorByTemplate"/>
                        </On>
                      </Case>
                    </On>
                  </Case>
                </On>
              </Case>
            </On>
          </Case>
          <Case Expression="TechnologyVT">
            <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate, TValueType.SpecifiedByTemplate, TValueType.ErrorByTemplate">
              <Case Expression="locTemplate.TechnologyVT">
                <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
                  <Execute Statement="Technology:= locTemplate.Technology"/>
                  <Execute Statement="TechnologyVT:= TValueType.SpecifiedByTemplate"/>
                </On>
                <On Select="TValueType.Error, TValueType.ErrorByTemplate">
                  <Execute Statement="Technology:= locTemplate.ErrorTechnology"/>
                  <Execute Statement="TechnologyVT:= TValueType.ErrorByTemplate"/>
                </On>
              </Case>
            </On>
          </Case>
<!-->->-->
        </ConditionalBlock>
        <Execute Statement="inherited ApplyTemplate"/>
      </Block>
    </Procedure>

    <Function Identifier="TResistanceSpecificationIndex.GetKey" VirtualMethod="vmGetKey" Type="Boolean">
      <Parameters>
        <Parameter Identifier="ComponentSpec" Type="TResistorSpec"/>
        <Parameter Identifier="Key" Direction="Output"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= False"/>
        <Case Expression="ComponentSpec.ResistanceMinVT" Optimalisation="integermapping">
          <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate"/>
          <Otherwise>
            <Exit/>
          </Otherwise>
        </Case>
        <Case Expression="ComponentSpec.ResistanceMaxVT" Optimalisation="integermapping">
          <On Select="TValueType.Unspecified, TValueType.ClearedByTemplate"/>
          <Otherwise>
            <Exit/>
          </Otherwise>
        </Case>
        <Case Expression="ComponentSpec.ResistanceVT" Optimalisation="integermapping">
          <On Select="TValueType.SpecifiedByTemplate, TValueType.Specified">
            <Execute Statement="Result:= True"/>
            <Execute Statement="Key:= ComponentSpec.Resistance"/>
          </On>
        </Case>
      </Block>
    </Function>

    <Constructor Identifier="TResistorCategory.Create">
      <Block>
        <Execute Statement="ResistanceSpecificationIndex:= TResistanceSpecificationIndex.Create(TMappingInt64ToObject.Create)"/>
      </Block>
    </Constructor>

    <Function Identifier="TResistorCategory.CreateSpecification" VirtualMethod="vmCreateSpecification" Type="TComponentSpec">
      <Block>
        <Execute Statement="Result:= TResistorSpec.Create"/>
      </Block>
    </Function>

    <Function Identifier="TResistorCategory.IsValidSpecification" VirtualMethod="vmIsValidSpecification" Type="Boolean">
      <Parameters>
        <Parameter Identifier="Specification" Type="TComponentSpec"/>
      </Parameters>
      <Block>
        <Case Expression="Specification.ComponentKindVT">
          <On Select="TValueType.Specified, TValueType.SpecifiedByTemplate"/>
          <Otherwise>
            <Exit Result="False"/>
          </Otherwise>
        </Case>
        <Case Expression="Specification.ComponentKind">
          <On Select="TComponentKind.Resistor, TComponentKind.VariableResistor"/>
          <Otherwise>
            <Exit Result="False"/>
          </Otherwise>
        </Case>
        <Execute Statement="Result:= True"/>
      </Block>
    </Function>

    <Function Identifier="TResistorCategory.IndexSearchSpecifications" VirtualMethod="vmIndexSearchSpecifications" Type="Boolean">
      <Parameters>
        <Parameter Identifier="ComponentSpec" Type="TComponentSpec"/>
        <Parameter Identifier="Specifications" Type="TSpecificationLink" Direction="Output"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= False"/>
        <Choose>
          <When Expression="ResistanceSpecificationIndex.GetLinks(ComponentSpec, ComponentSpecHead, Specifications)">
            <Execute Statement="Result:= True"/>
          </When>
        </Choose>
      </Block>
    </Function>

    <Function Identifier="TResistorCategory.GetTemplate" VirtualMethod="vmGetTemplate" Type="TComponentSpec">
      <Parameters>
        <Parameter Identifier="Specification" Type="TComponentSpec"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= ObjNil"/>
        <Case Expression="Specification.ComponentKind">
          <On Select="TComponentKind.Resistor">
            <Execute Statement="Result:= Template"/>
          </On>
          <On Select="TComponentKind.VariableResistor">
            <Execute Statement="Result:= TemplateVariable"/>
          </On>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TResistorCategory.CompareSpecifications" Type="Integer" VirtualMethod="vmCompareSpecifications">
      <Parameters>
        <Parameter Identifier="A" Type="TResistorSpec"/>
        <Parameter Identifier="B" Type="TResistorSpec"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= A.ComponentKind - B.ComponentKind"/>
        <Exit Condition="Result &lt;&gt; 0"/>
        <!--<-<TComponentSpec.CompareSpecifications-->
        <Execute Statement="Result:= CompareStateValueRange(A.ID, A.Resistance, A.ResistanceVT, A.ResistanceMin, A.ResistanceMinVT, A.ResistanceMax, A.ResistanceMaxVT, B.ID, B.Resistance, B.ResistanceVT, B.ResistanceMin, B.ResistanceMinVT, B.ResistanceMax, B.ResistanceMaxVT)"/>
        <Exit Condition="Result &lt;&gt; 0"/>
        <Execute Statement="Result:= CompareStateValueRange(A.ID, A.PowerRating, A.PowerRatingVT, A.PowerRatingMin, A.PowerRatingMinVT, A.PowerRatingMax, A.PowerRatingMaxVT, B.ID, B.PowerRating, B.PowerRatingVT, B.PowerRatingMin, B.PowerRatingMinVT, B.PowerRatingMax, B.PowerRatingMaxVT)"/>
        <Exit Condition="Result &lt;&gt; 0"/>
        <Execute Statement="Result:= CompareStateValueRange(A.ID, A.Tolerance, A.ToleranceVT, A.ToleranceMin, A.ToleranceMinVT, A.ToleranceMax, A.ToleranceMaxVT, B.ID, B.Tolerance, B.ToleranceVT, B.ToleranceMin, B.ToleranceMinVT, B.ToleranceMax, B.ToleranceMaxVT)"/>
        <Exit Condition="Result &lt;&gt; 0"/>
        <Execute Statement="Result:= CompareStateValue(A.ID, A.Technology, A.TechnologyVT, B.ID, B.Technology, B.TechnologyVT)"/>
        <Exit Condition="Result &lt;&gt; 0"/>
<!-->->-->
        <Execute Statement="Result:= inherited CompareSpecifications(A, B)"/>
      </Block>
    </Function>

    <Procedure Identifier="TResistorCategory.LoadTemplatesFromIniFile" VirtualMethod="vmLoadTemplatesFromIniFile">
      <Parameters>
        <Parameter Identifier="IniFile" Type="TCustomIniFile"/>
      </Parameters>
      <Constants>
        <Constant Identifier="sSection" Type="string" Expression="'Template.Resistor'"/>
        <Constant Identifier="sSectionVariable" Type="string" Expression="'Template.Resistor.Variable'"/>
      </Constants>

      <Block>
        <ConditionalBlock Expression="IniFile.SectionExists(sSection)">
          <Execute Statement="Template:= TResistorSpec.Create"/>
          <Execute Statement="Template.LoadFromIniFileSection(IniFile, sSection)"/>
        </ConditionalBlock>
        <ConditionalBlock Expression="IniFile.SectionExists(sSectionVariable)">
          <Execute Statement="TemplateVariable:= TResistorSpec.Create"/>
          <Execute Statement="TemplateVariable.LoadFromIniFileSection(IniFile, sSectionVariable)"/>
        </ConditionalBlock>
      </Block>
    </Procedure>

    <Function Identifier="TResistorCategory.CanExtractTemplateFromIniFile" VirtualMethod="vmCanExtractTemplateFromIniFile" Type="Boolean">
      <Parameters>
        <Parameter Identifier="IniFile" Type="TCustomIniFile"/>
        <Parameter Identifier="ComponentSpec" Type="TComponentSpec" Direction="Output"/>
      </Parameters>
      <Constants>
        <Constant Identifier="cResistorSection" Type="string" Expression="'Resistor'"/>
      </Constants>
      <Block>
        <Execute Statement="Result:= IniFile.SectionExists(cResistorSection)"/>
        <Block Condition="Result">
          <Execute Statement="ComponentSpec:= TResistorSpec.Create"/>
          <Execute Statement="ComponentSpec.LoadFromIniFileSection(IniFile, cResistorSection)"/>
        </Block>
      </Block>
    </Function>

  </Procedures>

  <Initialization>
    <Execute Statement="InitResistorTechnologyIndex(ResistorTechnologyIndex)"/>
  </Initialization>

  <Finalization>
    <Free Identifier="ResistorTechnologyIndex"/>
  </Finalization>

</pkg:Library>