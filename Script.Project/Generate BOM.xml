<?xml version="1.0" encoding="utf-8"?>
<pkg:Program xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xmlns="urn:schemas-www-wisware.nl-xmlscripting"
            xmlns:msx="urn:schemas-www-wisware.nl-xmlscripting-xml"
            xmlns:pkg="urn:schemas-www-wisware.nl-scriptingpackages"
            xmlns:fil="urn:schemas-www-wisware.nl-xmlscripting-filemanagement"
            xmlns:syu="urn:schemas-www-wisware.nl-xmlscripting-sysutils"
            xmlns:reg="urn:schemas-www-wisware.nl-xmlscripting-registry"
            xmlns:indx="urn:schemas-www-wisware.nl-xmlscripting-index"
            xmlns:rep="urn:schemas-www-wisware.nl-xmlscripting-report"
            xmlns:sts="urn:schemas-www-wisware.nl-xmlscripting-showstatus"
            xmlns:ado="urn:schemas-www-wisware.nl-xmlscripting-ado"
            xmlns:sys="urn:schemas-www-wisware.nl-xmlscripting"
            xmlns:obj="urn:schemas-www-wisware.nl-xmlscripting-objectlayer"
            xmlns:lil="urn:schemas-www-wisware.nl-xmlscripting-linkedlist"
            xsi:schemaLocation="urn:schemas-www-wisware.nl-scriptingpackages ../XmlSchemas.Common.XmlScript/XMLScripting.Packages.xsd">
  <pkg:ReportTargets>
    <pkg:Target Identifier="Report" Description="BOM report"/>
    <pkg:Target Identifier="DesignatorReport" Description="Designator report"/>
    <!--<pkg:Target Identifier="DesignatorStockReport" Description="Designator stock report"/>-->
    <pkg:Target Identifier="StockReport" Description="Partkeepr components"/>
    <pkg:Target Identifier="Info" Description="Info"/>
    <pkg:Target Identifier="Errors" Description="Errors"/>
    <!--<pkg:Target Identifier="Errors" Description="Fouten"/>
    <pkg:Target Identifier="Warnings" Description="Waarschuwingen"/>-->
  </pkg:ReportTargets>
  <pkg:Config xml:space="preserve">[Settings]
BomFilename=F:\Software development\XmlScripts\Projects\ElectronicsCalculations\Resources.Project\ESeriesBOM.xml
;BomFilename=F:\Software development\Constructie\FumeExtracter\eSchemas.Project\FumeExtracter.xml
BomCount=1
ConnectionString=Provider=MSDASQL.1;Persist Security Info=False;Data Source=PartKeepr;Initial Catalog=PartKeepr
ExportProjectID=?
[Display]
HideESerieOfValue=0
HideResistorMaxAmpVolt=0
HideZenerDiodeMaxAmp=0
MaxShowResistorMicroVoltage=1MV

[Template.Resistor.THT]
PowerRating = 250mW
Tolerance = 5%
Technology = metal film
Footprint = THT


[Template.Resistor.Variable.THT.rem]
;PowerRating = 250mW

[Template.PolarisedCapacitor.THT]
;Tolerance = 10%
VoltageRating = 50V
Technology = electrolytic
Footprint = THT

[Template.Capacitor.THT.rem]
;Tolerance = 10%
VoltageRating = 50V
Technology = ceramic
Footprint = THT

[Template.ZenderDiode.THT]
;Tolerance = 10%
PowerRating = 1W
;Footprint = THT

  </pkg:Config>
  <Imports>
    <Import Identifier="ElectronicUtils" Filename="..\Script.Common.Electronics\ElectronicUtils.xml"/>
    <Import Identifier="BomStrings" Filename="..\Script.Common.Electronics\BOM strings en-GB.xml"/>
    <Import Identifier="BomClasses" Filename="..\Script.Common.Electronics\BOM classes.xml"/>
    <Import Identifier="ResistorClasses" Filename="..\Script.Common.Electronics\BOM ResistorClasses.xml"/>
    <Import Identifier="CapacitorClasses" Filename="..\Script.Common.Electronics\BOM CapacitorClasses.xml"/>
    <Import Identifier="InductorClasses" Filename="..\Script.Common.Electronics\BOM InductorClasses.xml"/>
    <Import Identifier="ZenerDiodeClasses" Filename="..\Script.Common.Electronics\BOM ZenerDiodeClasses.xml"/>
    <Import Identifier="ConnectorClasses" Filename="..\Script.Common.Electronics\BOM ConnectorClasses.xml"/>
    <Import Identifier="GenericComponentClasses" Filename="..\Script.Common.Electronics\BOM GenericComponentClasses.xml"/>
    <Import Identifier="CategoryContainer" Filename="..\Script.Common.Electronics\BOM CategoryContainer.xml"/>
    <Import Identifier="StockManager" Filename="..\Script.Common.Electronics\BOM StockManager.xml"/>
    <Import Identifier="BillOfMaterialClass" Filename="..\Script.Common.Electronics\BOM BillOfMaterialClass.xml"/>
    <Import Identifier="PartKeeprProjectExport" Filename="..\Script.Common.Electronics\BOM PartKeeprProjectExport.xml"/>
  </Imports>
  <Uses>
    <Use Identifier="ElectronicUtils"/>
    <Use Identifier="BomStrings"/>
    <Use Identifier="BomClasses"/>
    <Use Identifier="CategoryContainer"/>
    <Use Identifier="BillOfMaterialClass"/>
    <Use Identifier="StockManager"/>
    <Use Identifier="PartKeeprProjectExport"/>
  </Uses>
  <Constants>
    <Constant Identifier="connsPartKeepr" Type="string" Expression="'Provider=MSDASQL.1;Persist Security Info=False;Data Source=PartKeepr;Initial Catalog=PartKeepr'"/>
    <Constant Identifier="secSettings" Type="string" Expression="'Settings'"/>
    <Constant Identifier="secDisplay" Type="string" Expression="'Display'"/>
    <Constant Identifier="keyBomFilename" Type="string" Expression="'BomFilename'"/>
    <Constant Identifier="keyBomCount" Type="string" Expression="'BomCount'"/>
    <Constant Identifier="keyConnectionString" Type="string" Expression="'ConnectionString'"/>
    <Constant Identifier="keyExportProjectID" Type="string" Expression="'ExportProjectID'"/>
    <Constant Identifier="keyHideESerieOfValue" Type="string" Expression="'HideESerieOfValue'"/>
    <Constant Identifier="keyHideResistorMaxAmpVolt" Type="string" Expression="'HideResistorMaxAmpVolt'"/>
    <Constant Identifier="keyHideZenerDiodeMaxAmp" Type="string" Expression="'HideZenerDiodeMaxAmp'"/>
    <Constant Identifier="keyMaxShowResistorMicroVoltage" Type="string" Expression="'MaxShowResistorMicroVoltage'"/>
  </Constants>
  <Variables>
    <Variable Identifier="ConnectionString" Type="string" Init="connsPartKeepr"/>
    <Variable Identifier="BomFilename" Type="string" Init="''"/>
    <Variable Identifier="BomCountS" Type="string" Init="''"/>
    <Variable Identifier="BomCount" Type="Integer" Init="1"/>
    <Variable Identifier="BillOfMaterials" Type="TBillOfMaterials" Init="TBillOfMaterials.Create"/>
    <Variable Identifier="StockManager" Type="TStockManager" Init="TStockManager.Create"/>
    <Variable Identifier="DBConnection" Type="Connection"/>
  </Variables>
  <Block>
    <Variable Identifier="StartTime" Type="Int64" Init="QueryPerformanceCounter" />

    <rep:Reporter.DefaultTarget Identifier="Info"/>
    <Execute Statement="HideESerieOfValue:= ConfigInifile.ReadBool(secDisplay, keyHideESerieOfValue, HideESerieOfValue)"/>
    <Execute Statement="HideResistorMaxAmpVolt:= ConfigInifile.ReadBool(secDisplay, keyHideResistorMaxAmpVolt, HideESerieOfValue)"/>
    <Execute Statement="HideZenerDiodeMaxAmp:= ConfigInifile.ReadBool(secDisplay, keyHideZenerDiodeMaxAmp, HideESerieOfValue)"/>
    <Variable Identifier="MaxShowResistorMicroVoltageS" Type="string" Init="ConfigInifile.ReadString(secDisplay, keyMaxShowResistorMicroVoltage, FormatMicroVolt(MaxShowResistorMicroVoltage))"/>
    <Raise Expression="Exception.Create('Invalid voltage: ' + MaxShowResistorMicroVoltageS)" Condition="not StrToMicroVolts(MaxShowResistorMicroVoltageS, MaxShowResistorMicroVoltage)"/>
    <Execute Statement="ConnectionString:= ConfigInifile.ReadString(secSettings, keyConnectionString, ConnectionString)"/>
    <ConditionalBlock Expression="not CommandlineVariables.GetValue(keyBomFilename, BomFilename)">
      <Execute Statement="BomFilename:= ConfigInifile.ReadString(secSettings, keyBomFilename, BomFilename)"/>
    </ConditionalBlock>
    <Choose>
      <When Expression="CommandlineVariables.GetValue(keyBomCount, BomCountS)" >
        <Execute Statement="BomCount:= StrToInt(BomCountS)"/>
      </When>
      <Otherwise>
        <Execute Statement="BomCount:= ConfigInifile.ReadInteger(secSettings, keyBomCount, BomCount)"/>
      </Otherwise>
    </Choose>
    <Execute Statement="BillOfMaterials.LoadTemplatesFromIniFile(ConfigInifile)"/>
    <Execute Statement="BillOfMaterials.LoadFromFile(BomFilename)"/>
    <Execute Statement="BillOfMaterials.ConsolidateSpecifications"/>
    <ado:Connection.OpenBlock ConnectionString="ConnectionString" Connection="DBConnection">
      <Execute Statement="StockManager.LoadFromDB(DBConnection)"/>
      <Execute Statement="StockManager.ConsolidateSpecifications"/>

      <Execute Statement="BillOfMaterials.AssignStockComponents(StockManager)"/>
      <rep:Reporter.DefaultTarget Identifier="Report"/>
      <Execute Statement="BillOfMaterials.Report(BomCount)"/>

      <rep:Reporter.DefaultTarget Identifier="StockReport"/>
      <Execute Statement="StockManager.Report"/>
      <rep:Reporter.DefaultTarget Identifier="Info"/>

      <rep:Reporter.DefaultTarget Identifier="DesignatorReport"/>
      <Execute Statement="BillOfMaterials.ReportDesignators"/>
      

      <Variable Identifier="EndTime" Type="Int64" Init="QueryPerformanceCounter" />
      <rep:Reporter.Information Text="Format(sTimeMeasure, (EndTime-StartTime)/QueryPerformanceFrequency)" Target="Info"/>

      <Block Condition="ConfigInifile.ValueExists(secSettings, keyExportProjectID)">
        <rep:Reporter.DefaultTarget Identifier="Info"/>
        <Variable Identifier="ExportProjectIDString" Type="string" Init="ConfigInifile.ReadString(secSettings, keyExportProjectID, '')"/>
        <Choose>
          <When Expression="ExportProjectIDString = '?'">
            <Execute Statement="ReportPartKeeprProjects(DBConnection)"/>
          </When>
          <Otherwise>
            <Variable Identifier="ExportProjectID" Type="Integer" Init="ConfigInifile.ReadInteger(secSettings, keyExportProjectID, -1)"/>
            <Execute Statement="ExportToPartKeeprProject(DBConnection, BillOfMaterials, ExportProjectID)" Condition="ExportProjectID &lt;&gt; -1"/>
            <ExitOnAbortRequest/>
          </Otherwise>
        </Choose>

      </Block>
    </ado:Connection.OpenBlock>

  </Block>
</pkg:Program>